
- name: Starship Configuration
  hosts: all
  tasks:
    - name: Check if starship initialization is present in ~/.bashrc
      ansible.builtin.shell: |
        grep -qF 'eval "$(starship init bash)"' ~/.bashrc
      register: starship_check
      changed_when: false
      failed_when: false

    - name: Debug starship_check
      ansible.builtin.debug:
        var: starship_check
      when: starship_check is defined

    - name: Append ~/.bashrc with command to run starship.rs
      ansible.builtin.blockinfile:
        path: ~/.bashrc
        block: |
          eval "$(starship init bash)"
        marker: "# {mark} ANSIBLE MANAGED BLOCK - DO NOT EDIT"
        insertafter: EOF
      when: not starship_check.rc

      #broken to all heck - don't use